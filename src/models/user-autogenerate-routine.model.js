const db = require('../config/db');

// 1 - Obtener los objetivos del usuario y guardarlos en un objeto
// 2 - obtener las rutinas que ha realizado con el objetivos_id que ha guardado en sus preferencias
// y guardamos las rutinas que ha realizado en el objeto
// 3 - Obtenemos las tutinas autogenerated_routine que son las rutinas sugeridas por el sistema
// y las aÃ±adimos al array del objeto
// 4 - Devolver de forma aleatoria rutinas que el usuario no ha realizado y tienen el mismo objetivo
// Esto devolvera un id de rutina, que sera la rutina que vamos a devolver al usuario
let usuarioObjetivos = {
    idusuario: 0,
    objetivo: 0,
    rutinas_realizadas: []    
}

const objetivosUsuario = async (id) => {
    //Tener encuenta si no tiene objetivos asignados, en ese caso no se le puede generar una rutina

    const [result] = await db.query( 
 `SELECT
    id,
    id_usuarios,
    id_objetivos,
    fecha
FROM
    objetivos_usuarios
WHERE
    id_usuarios = ?
ORDER BY
    fecha DESC   
LIMIT 1; `, [id]);

    usuarioObjetivos.idusuario = id;
    usuarioObjetivos.objetivo = result[0].id_objetivos;
    
    return result;
}

const autoGenerate = async (id) => {
   
    //Obtener el objetivo del usuario
    const result = objetivosUsuario(id)

    console.log(result, ' - VALOR DE RESULTADO EN MODELO');
    return result;
}

module.exports = {autoGenerate};
